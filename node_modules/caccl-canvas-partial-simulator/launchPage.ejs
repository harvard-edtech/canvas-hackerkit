<head>
  <!-- Metadata to make scaling work better -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Launch</title>

  <!-- jQuery -->
  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

  <!-- Import google font to match Canvas authorization page font -->
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">

  <!-- Inline styles for simplicity -->
  <!-- Designed to replicate Canvas authorization page to minimize confusion -->
  <style type="text/css">
    /* ----- PAGE/LAYOUT: ----- */

    /* Body (background color and font to match Canvas authorization page) */
    body {
      background-color: #313c45;
      text-align: center;
      font-family: 'Lato', sans-serif;
    }

    /* Container so the course chooser won't span the whole width of the page */
    .container {
      margin-left: 30px;
      margin-right: 30px;
      margin-top: 10px;
      max-width: 850px;
      width: 100%;
      background-color: #37444e;
      color: black;
      border-radius: 5px;
      -webkit-box-shadow: 1px 1px 5px 0px rgba(0,0,0,0.75);
      -moz-box-shadow: 1px 1px 5px 0px rgba(0,0,0,0.75);
      box-shadow: 1px 1px 5px 0px rgba(0,0,0,0.75);
      display: inline-block;
      text-align: left;
    }

    /* Content header (top of page, separated from content) */
    .header {
      border-bottom: 1px solid black;
      padding-left: 15px;
      padding-right: 15px;
      padding-top: 20px;
      padding-bottom: 20px;
      background-color: #37444e;
      color: white;
      border-radius: 5px 5px 0 0;
    }

    /* Page title */
    .title {
      font-size: 1.5em;
      font-weight: bold;
    }

    /* Page subtitle, slightly dimmed */
    .subtitle {
      font-size: 1.2em;
      color: #ccc;
    }

    /* Lower portion of the page, white background, the content: course list */
    .content {
      background-color: white;
      border-radius: 0 0 5px 5px;

      padding-left: 15px;
      padding-right: 15px;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    /* Authorize button) */
    .launch-button {
      display: block;
      background-color: #3b8edc;
      color: white;
      font-weight: bold;
      border-radius: 5px;
      padding-left: 15px;
      padding-right: 15px;
      padding-top: 20px;
      padding-bottom: 20px;
      margin-bottom: 10px;
      text-decoration: none;
      text-align: center;
      border: 1px solid gray;
      font-size: 1.2em;
      width: 100%;
    }

    /* Highlight the authorize button on hover */
    .launch-button:hover {
      background-color: #48a8f0;
    }
  </style>

  <script type="text/javascript">
    function submit() {
      // Make a new call to get new launch info
      $.get('<%= launchDataURL %>', function (data) {
        if (data.error) {
          // Display error and stop fetching
          alert('An error occurred: ' + data.error + '\nPlease try again.');
          return;
        }

        // Create form fields
        document.getElementById('form').innerHTML = '';

        // Update the launch form with the new data
        for (var prop in data) {
          document.getElementById('form').innerHTML += '<input type="hidden" name="' + prop + '" value="' + data[prop] + '">\n';
        }

        // Submit the form
        document.getElementById('form').submit();
      });
    }
  </script>

</head>

<body>

  <!-- Page content -->
  <div class="container">

    <!-- Header (title and subtitle) -->
    <div class="header">
      <div class="title">Simulated LTI Launch</div>
      <div class="subtitle">click to simulate an LTI launch</div>
    </div>

    <!-- Content (list of courses) -->
    <div class="content">
      <form action="<%= launchURL %>" method="POST" id="form">
        <!-- Form content will be populated after GET -->
      </form>
      <button id="launch-button" type="button" onclick="submit()" class="launch-button">
        Simulate Launch
      </button>
    </div><!-- End Content -->

  </div><!-- End Container -->

</body>
